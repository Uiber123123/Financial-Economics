# 📈 投资组合优化系统

基于Python和Streamlit的投资组合优化平台，实现马科维茨现代投资组合理论，支持股票数据获取、有效前沿计算和策略回测。适用于金融学、经济学专业的教学和研究。

## ✨ 主要功能

### 1. 📥 股票数据下载
- 支持批量下载A股股票数据
- 获取日线级别的收盘价、开盘价、最高价、最低价、成交量等信息
- 支持自定义时间范围
- 数据导出为CSV格式
- 基于本地SQLite数据库，快速高效

### 2. 📊 投资组合优化
- 基于马科维茨现代投资组合理论
- **二次规划（QP）数值优化**计算有效前沿
  - 完整展示双曲线形态（包括无效前沿）
  - 支持允许做空/不允许做空两种模式
  - 使用SciPy优化算法，稳定可靠
- 自动计算三种最优组合：
  - 🌟 **最大夏普比率组合**：风险调整后收益最优
  - 🛡️ **最小方差组合**：风险最小化
  - 💜 **效用最优组合**：U = E(r) - 0.005·A·σ²
- **风险厌恶系数A可调节**（1-10）
  - A越小，风险偏好越强
  - A越大，风险厌恶越强
- 可视化风险-收益关系
- 资本市场线（CML）展示
- 提供具体的投资比例建议
- 样本内表现分析

### 3. 📈 样本外回测
- 训练集/测试集分割
- 多策略对比（最大夏普、最小方差、等权重）
- 丰富的性能指标：
  - 夏普比率（Sharpe Ratio）
  - 索提诺比率（Sortino Ratio）
  - 最大回撤（Max Drawdown）
  - 卡玛比率（Calmar Ratio）
  - 胜率（Win Rate）
- 滚动夏普比率分析
- 性能指标可视化对比

## 🚀 快速开始

### 第一步：构建数据库 ⚠️ 必须

在首次使用前，必须先构建本地数据库：

```bash
python build_database.py
```

详细说明请查看 [DATABASE_SETUP.md](DATABASE_SETUP.md)

### 第二步：安装依赖

```bash
pip install -r requirements.txt
```

### 第三步：运行应用

**Windows 用户（推荐）**:
```bash
# 双击运行
start_system.bat

# 或命令行
streamlit run app.py
```

**其他系统**:
```bash
streamlit run app.py
```

### 访问网站

浏览器自动打开 `http://localhost:8501`

### 登录信息

- 用户名: `张洲宁`
- 密码: `202302234`

## 📁 项目结构

```
.
├── app.py                      # Streamlit主应用
├── database_manager.py         # 数据库管理模块
├── build_database.py           # 数据库构建脚本
├── portfolio_optimizer.py      # 投资组合优化模块（二次规划）
├── backtesting.py              # 回测模块
├── stock_utils.py              # 股票工具模块
├── stock_data.db               # SQLite数据库（运行后生成）
├── Sticky_Stock.txt            # 股票列表JSON文件
├── Data Source Construction/   # 原始数据文件目录
│   └── RESSET_DRESSTK_*.xlsx   # 股票价格数据
├── requirements.txt            # 依赖包列表
├── README.md                   # 项目说明
├── DATABASE_SETUP.md           # 数据库设置指南
├── CHANGELOG.md                # 更新日志
└── DEPLOY.md                   # 部署指南
```

## 📖 使用说明

### 1. 数据下载

1. 进入"数据下载"页面
2. 从下拉列表中选择股票（支持搜索）
   - 可以输入股票代码或名称快速查找
   - 支持多选，点击即可添加/移除
3. 选择时间范围
4. 点击"获取数据"
5. 下载CSV文件（可选）

### 2. 投资组合优化

1. 确保已下载股票数据
2. 进入"投资组合优化"页面
3. 选择要分析的股票（建议2-10只）
4. 通过滑块选择时间范围
5. **调节风险厌恶系数A**（1-10）
   - A越小，风险偏好越强
   - A越大，风险厌恶越强
6. 点击"计算有效前沿"
7. 查看三种最优组合：
   - 🌟 最大夏普比率组合
   - 🛡️ 最小方差组合
   - 💜 效用最优组合

### 3. 回测分析

1. 确保已下载股票数据
2. 进入"回测分析"页面
3. 选择回测股票
4. 设置训练集比例（默认70%）
5. 点击"运行回测"
6. 对比不同策略的样本外表现

## 🔧 技术栈

- **数据存储**: SQLite
- **数据处理**: Pandas, NumPy
- **优化算法**: SciPy (二次规划)
- **可视化**: Plotly
- **Web框架**: Streamlit
- **数值计算**: NumPy线性代数

## 📊 示例股票代码

### 银行板块
- 000001 - 平安银行
- 600000 - 浦发银行
- 600036 - 招商银行
- 601398 - 工商银行

### 科技板块
- 000063 - 中兴通讯
- 000725 - 京东方A
- 002415 - 海康威视
- 300059 - 东方财富

### 消费板块
- 000858 - 五粮液
- 600519 - 贵州茅台
- 000333 - 美的集团

## ⚠️ 注意事项

1. 首次使用前必须运行 `build_database.py` 构建数据库
2. 建议选择至少1年以上的历史数据以获得可靠结果
3. 投资组合优化建议选择2-10只股票
4. 无风险利率使用中国10年期国债收益率的日几何平均
5. 有效前沿使用二次规划数值优化，计算稳定可靠
6. 本系统仅用于学术研究和学习，不构成投资建议




